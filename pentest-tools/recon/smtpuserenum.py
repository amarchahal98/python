#!/usr/bin/python3

import os
from pwn import *

os.system("nmap -p 25 10.11.1.1-254 -oG nmap-smtp.out && grep 'open' nmap-smtp.out | cut -d' ' -f2 > open-25.out")

f = open("open-25.out", "r")

for ip in f:
    ip = ip.rstrip('\n')
    r = remote(ip, 25)
    r.recvuntil("220")
    banner = r.recvline()
    r.sendline("VRFY user")
    check = r.recvline(timeout=5)
    if str(check) == "b''":
        continue

    else:
        users = open("users.txt", "r")
        for user in users:
            user = user.rstrip('\n')
            r.sendline("VRFY " + user)
            response = r.recvline(timeout=5)
            response = str(response)
            code = response[2:5]
            if code == '250' or code == '252':
                print("User " + user + " exists on " + ip)
            else:
                print("User does not exist: " + user)

        users.close()
        r.close()
